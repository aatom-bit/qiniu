<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Floating Ball</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&display=swap');
        
        body {
            font-family: 'Noto Color Emoji', 'Apple Color Emoji', 'Segoe UI Emoji', sans-serif;
            user-select: none;
            -webkit-user-select: none;
            -webkit-user-drag: none;
        }
        html, body {
            margin: 0;
            height: 100%;
            background: transparent;
            box-shadow: none;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            touch-action: none;
            -webkit-touch-callout: none;
            line-height: 0;
            /* box-shadow: 0 0 0px rgba(0, 0, 0, 0); */
        }

        /* Á¶ÅÁî®ÊâÄÊúâÈÄâÊã©È´ò‰∫Æ */
        ::selection {
            background: transparent;
            color: inherit;
        }

        ::-moz-selection {
            background: transparent;
            color: inherit;
        }

        #ball-container {
            width: 100px;
            height: 100px;
            position: relative;
            cursor: grab;
            box-shadow: none;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            -webkit-user-drag: none;
            -webkit-touch-callout: none;
            margin: 0;
            padding: 0;
            border: none;
        }

        #ball {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #ff9a6b, #ff6b6b);
            cursor: grab;
            transition: transform 0.1s ease-out;
            box-shadow: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            overflow: visible;
            margin: 0;
            padding: 0;
            border: none;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            -webkit-user-drag: none;
            -webkit-touch-callout: none;
        }

        #ball.dragging {
            cursor: grabbing;
            transform: translate(-50%, -50%) scale(0.95) !important;
        }

        #ball::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0) 50%);
            border-radius: 50%;
            pointer-events: none;
        }

        #ball-icon {
            position: relative;
            z-index: 2;
            transition: opacity 0.3s ease;
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.5);
            }
            50% {
                box-shadow: 0 0 0 12px rgba(255, 107, 107, 0);
            }
        }

        #ball.active {
            animation: rotate 3s linear infinite !important;
        }

        #ball.recording {
            animation: pulse 0.8s cubic-bezier(0.4, 0, 0.6, 1) infinite !important;
        }

        @keyframes rotate {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* Ê∂üÊº™Â±Ç */
        #ripple {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid rgba(255, 107, 107, 0.6);
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

        @keyframes ripple-expand {
            0% {
                width: 60px;
                height: 60px;
                border-color: rgba(255, 107, 107, 0.8);
                opacity: 1;
            }
            100% {
                width: 120px;
                height: 120px;
                border-color: rgba(255, 107, 107, 0);
                opacity: 0;
            }
        }

        #ripple.active {
            animation: ripple-expand 0.6s ease-out;
        }

        #stats {
            position: absolute;
            bottom: 3px;
            right: 3px;
            font-size: 9px;
            color: #fff;
            background: rgba(0, 0, 0, 0.6);
            padding: 2px 3px;
            border-radius: 2px;
            font-family: monospace;
            line-height: 1;
            text-align: right;
            width: 22px;
            z-index: 3;
        }

        #ball.day {
            background: radial-gradient(circle at 30% 30%, #ffeb3b, #ffc107);
        }

        #ball.night {
            background: radial-gradient(circle at 30% 30%, #424242, #1a1a1a);
            color: #fff;
        }

        #ball.dusk {
            background: radial-gradient(circle at 30% 30%, #ff7043, #e64a19);
        }

        /* Ë£ÖÈ•∞ÂÖÉÁ¥† */
        #decorations {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            border-radius: 50%;
            overflow: hidden;
            z-index: 1;
            pointer-events: none;
        }

        .decoration {
            position: absolute;
            font-size: 18px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1;
        }

        .decoration.show {
            opacity: 0.7;
        }

        /* ‰∫ëÊúµË£ÖÈ•∞ */
        .cloud {
            top: 10px;
            left: 45%;
            transform: translateX(-50%);
        }

        /* ÊòüÊòüË£ÖÈ•∞ */
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.8; }
        }

        .star {
            animation: twinkle 2s infinite;
        }

        .star-1 {
            top: 8%;
            left: 10%;
        }

        .star-2 {
            top: 8%;
            right: 10%;
        }

        .star-3 {
            bottom: 8%;
            left: 10%;
        }

        .star-4 {
            bottom: 8%;
            right: 10%;
        }

        /* ÊúàÂÖâÂÖâÊôï */
        @keyframes glow {
            0%, 100% { 
                box-shadow: 0 0 8px rgba(200, 200, 255, 0.3) inset;
            }
            50% { 
                box-shadow: 0 0 15px rgba(200, 200, 255, 0.6) inset;
            }
        }

        #ball.night {
            animation: glow 3s ease-in-out infinite;
        }

        /* È£éÂêπÂä®Áîª */
        @keyframes float {
            0%, 100% { transform: translateX(0px); }
            50% { transform: translateX(2px); }
        }

        .decoration.float {
            animation: float 2s ease-in-out infinite;
        }

        /* Â∑•‰ΩúÂä®Áîª */
        @keyframes work-bounce {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-3px); }
        }

        #ball.working .decoration {
            animation: work-bounce 0.8s ease-in-out infinite;
        }

    </style>
</head>
<body>
<div id="ball-container" draggable="false">
    <div id="ball" draggable="false" style="image-rendering: pixelated; touch-action: none;">
        <div id="decorations">
            <div class="decoration cloud" id="cloud">‚òÅÔ∏è</div>
            <div class="decoration star star-1" id="star-1">‚≠ê</div>
            <div class="decoration star star-2" id="star-2">‚ú®</div>
            <div class="decoration star star-3" id="star-3">‚≠ê</div>
            <div class="decoration star star-4" id="star-4">‚ú®</div>
        </div>
        <div id="ball-icon">‚òÄÔ∏è</div>
        <div id="stats">CPU RAM</div>
    </div>
    <div id="ripple"></div>
</div>

<script type="module">
    const ball = document.getElementById('ball');
    const ballIcon = document.getElementById('ball-icon');
    const statsDiv = document.getElementById('stats');
    const ripple = document.getElementById('ripple');
    const cloudDeco = document.getElementById('cloud');
    const starDecos = [document.getElementById('star-1'), document.getElementById('star-2'), 
                       document.getElementById('star-3'), document.getElementById('star-4')];
    
    let isBegin = false;
    let isLongPressActive = false; 
    
    // ÊãñÂä®ÂÆûÁé∞
    let dragging = false;
    let hasMoved = false;
    let longPressTimer = null;
    let startX = 0, startY = 0;
    let windowStartX = 0, windowStartY = 0;
    let mouseDownTime = 0;

    // ===== ÂÖ®Â±Ä‰∫ã‰ª∂Á¶ÅÁî® =====
    // Á¶ÅÊ≠¢ÊâÄÊúâÂΩ¢ÂºèÁöÑÊñáÊú¨ÈÄâÊã©ÂíåÊãñÂä®ÂèçÈ¶à
    document.addEventListener('selectstart', (e) => {
        e.preventDefault();
        return false;
    }, { capture: true });

    document.addEventListener('mousedown', (e) => {
        if (e.detail > 1) { // Â§öÂáª
            e.preventDefault();
            return false;
        }
    }, { capture: true });

    document.addEventListener('mousemove', (e) => {
        // Á¶ÅÊ≠¢ÁîüÊàêÈÄâÊã©ÊãñÊãΩÂèçÈ¶à
    }, { capture: true });

    document.addEventListener('dragstart', (e) => {
        e.preventDefault();
        return false;
    }, { capture: true });

    document.addEventListener('drag', (e) => {
        e.preventDefault();
        return false;
    }, { capture: true });

    // Á¶ÅÁî®ÊñáÊú¨ÈÄâÊã©ÁöÑCSS cursor
    document.body.style.WebkitUserSelect = 'none';
    document.body.style.MozUserSelect = 'none';
    document.body.style.msUserSelect = 'none';
    document.body.style.userSelect = 'none';
    
    // ===== Ê∂üÊº™ÊïàÊûú =====
    const playRipple = () => {
        ripple.classList.remove('active');
        // Âº∫Âà∂ÈáçÊéí‰ª•ÈáçÊñ∞Ëß¶ÂèëÂä®Áîª
        void ripple.offsetWidth;
        ripple.classList.add('active');
    };

    // Ëé∑ÂèñÊó∂Èó¥ÊÆµÂπ∂Êõ¥Êñ∞Â§ñËßÇÂèäË£ÖÈ•∞
    const updateTimeTheme = () => {
        const hour = new Date().getHours();
        
        // ÈöêËóèÊâÄÊúâË£ÖÈ•∞
        cloudDeco.classList.remove('show', 'float');
        starDecos.forEach(star => star.classList.remove('show'));
        
        if (hour >= 6 && hour < 12) {
            // Êó©‰∏äÔºöÈªÑËâ≤Â§™Èò≥ + ‰∫ëÊúµ
            ball.className = 'day';
            ballIcon.textContent = 'üåÖ';
            cloudDeco.classList.add('show', 'float');
            cloudDeco.textContent = '‚òÅÔ∏è';
        } else if (hour >= 12 && hour < 17) {
            // ‰∏≠ÂçàÂà∞‰∏ãÂçàÔºöÊòé‰∫ÆÂ§™Èò≥ + ÂÅ∂Â∞îÁöÑ‰∫ëÊúµ
            ball.className = 'day';
            ballIcon.textContent = '‚òÄÔ∏è';
            if (Math.random() > 0.5) {
                cloudDeco.classList.add('show', 'float');
                cloudDeco.textContent = '‚òÅÔ∏è';
            }
        } else if (hour >= 17 && hour < 20) {
            // ÂÇçÊôöÔºöËêΩÊó• + ‰∫ëÊúµ
            ball.className = 'dusk';
            ballIcon.textContent = 'üåÖ';
            cloudDeco.classList.add('show', 'float');
            cloudDeco.textContent = 'üåßÔ∏è';
        } else {
            // Êôö‰∏äÔºöÊúà‰∫Æ + ÊòüÊòü
            ball.className = 'night';
            ballIcon.textContent = hour >= 20 && hour < 23 ? 'üåô' : '‚≠ê';
            cloudDeco.classList.add('show');
            cloudDeco.textContent = 'üåô';
            starDecos.forEach(star => star.classList.add('show'));
        }
    };

    // Ëé∑ÂèñÁ≥ªÁªüCPUÂíåRAMÂç†Áî®
    const updateStats = async () => {
        try {
            const stats = await window.electronAPI.getSystemStats?.();
            if (stats) {
                statsDiv.innerHTML = `${stats.cpu}<br/>${stats.ram}`;
            }
        } catch (error) {
            console.error('Ëé∑ÂèñÁ≥ªÁªü‰ø°ÊÅØÂ§±Ë¥•:', error);
        }
    };

    // ÂàùÂßãÂåñÂíåÂÆöÊó∂Êõ¥Êñ∞
    updateTimeTheme();
    updateStats();
    setInterval(updateTimeTheme, 60000); // ÊØèÂàÜÈíüÊõ¥Êñ∞‰∏ÄÊ¨°‰∏ªÈ¢ò
    setInterval(updateStats, 2000); // ÊØè2ÁßíÊõ¥Êñ∞‰∏ÄÊ¨°Á≥ªÁªü‰ø°ÊÅØ

    // ËßÜËßâÂèçÈ¶àÂáΩÊï∞
    const setBallState = (type) => {
        // ÂÖàÁßªÈô§ÊâÄÊúâÂä®ÁîªÁ±ª
        ball.classList.remove('active', 'recording', 'working', 'dragging');
        
        if (type === 'recording') {
            ball.classList.add('recording');
            cloudDeco.classList.remove('show');
            starDecos.forEach(star => star.classList.remove('show'));
        } else if (type === 'active') {
            ball.classList.add('active');
            cloudDeco.classList.remove('show');
            starDecos.forEach(star => star.classList.remove('show'));
        } else {
            updateTimeTheme(); // ÊÅ¢Â§çÊó∂Èó¥‰∏ªÈ¢ò
        }
    };
    
    ball.addEventListener('mousedown', (e) => {
        console.log("ÊÇ¨ÊµÆÁ™óÂ∑¶ÈîÆÁÇπÂáª")
        if (e.button !== 0) return;
        
        ball.classList.add('dragging');
        playRipple(); // Ëß¶ÂèëÊ∂üÊº™ÊïàÊûú
        
        dragging = true;
        startX = e.screenX;
        startY = e.screenY;
        hasMoved = false;
        mouseDownTime = Date.now();
        
        window.electronAPI.getWindowPosition()
            .then(pos => {
                windowStartX = pos.x;
                windowStartY = pos.y;
            })
            .catch(err => {
                console.error('Ëé∑ÂèñÁ™óÂè£‰ΩçÁΩÆÂ§±Ë¥•:', err);
            });

        longPressTimer = setTimeout(() => {
            if (!hasMoved && dragging) {
                playRipple(); // Ëß¶ÂèëÊ∂üÊº™ÊïàÊûú
                isLongPressActive = true;
                console.log("Ëß¶ÂèëÈïøÊåâÔºöÂºÄÂßãÂΩïÈü≥");
                window.electronAPI.QuickListen(true, true);
                setBallState('recording');
            }
        }, 250);
        
        e.preventDefault();
        e.stopPropagation();
    });
    
    window.addEventListener('mousemove', (e) => {
        if (!dragging) return;
        
        const deltaX = e.screenX - startX;
        const deltaY = e.screenY - startY;
        
        // ‰ΩçÁßªË∂ÖËøá 5 ÂÉèÁ¥†Âà§ÂÆö‰∏∫ÁßªÂä®
        if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {
            if (!hasMoved) {
                hasMoved = true;
                clearTimeout(longPressTimer); // ÁßªÂä®‰∫ÜÔºåÂèñÊ∂àÈïøÊåâÂà§ÂÆö
                console.log("Ê£ÄÊµãÂà∞ÁßªÂä®ÔºåÂèñÊ∂àÈïøÊåâÂà§ÂÆö");
            }
            
            window.electronAPI.dragWindow({
                x: windowStartX + deltaX,
                y: windowStartY + deltaY
            });
        }
    });
    
    window.addEventListener('mouseup', () => {
        if (!dragging) return;
        
        ball.classList.remove('dragging');
        const clickDuration = Date.now() - mouseDownTime;
        clearTimeout(longPressTimer);

        if (isLongPressActive) {
            console.log("ÈïøÊåâÁªìÊùüÔºöÂÅúÊ≠¢ÂΩïÈü≥");
            window.electronAPI.QuickListen(true, false);
            isLongPressActive = false;
            setBallState(isBegin ? 'active' : 'default');
        } 
        else if (!hasMoved && clickDuration < 200) {
            console.log("Ëß¶ÂèëÂçïÂáªÔºöÂàáÊç¢‰∏ªÁ™óÂè£");
            playRipple(); // Ëß¶ÂèëÊ∂üÊº™ÊïàÊûú
            window.electronAPI.toggleMainWindow();
        }

        dragging = false;
    });
    
    // ÂèåÂáª‰∫ã‰ª∂
    ball.addEventListener('dblclick', (e) => {
        playRipple(); // Ëß¶ÂèëÊ∂üÊº™ÊïàÊûú
        isBegin = !isBegin;
        console.log('Ëß¶ÂèëÂèåÂáªÔºåÁä∂ÊÄÅ:', isBegin ? 'ÂºÄÂßã' : 'ÂÅúÊ≠¢');
        window.electronAPI.QuickListen(false, isBegin);
        setBallState(isBegin ? 'active' : 'default');
    });
    
    // Èò≤Ê≠¢ÊñáÊú¨ÈÄâ‰∏≠ÂíåÈÄâÊã©
    document.addEventListener('selectstart', (e) => {
        e.preventDefault();
        return false;
    });

    ball.addEventListener('selectstart', (e) => {
        e.preventDefault();
        return false;
    });

    // Á¶ÅÁî®ÂèåÂáªÈÄâÊã©
    document.addEventListener('dblclick', (e) => {
        if (e.target === ball || ball.contains(e.target)) {
            e.preventDefault();
            return false;
        }
    }, { capture: true });

    // Á¶ÅÁî®ÊãñÂä®‰∫ã‰ª∂
    ball.addEventListener('dragstart', (e) => {
        e.preventDefault();
        return false;
    });

    // Á¶ÅÁî®‰∏ä‰∏ãÊñáËèúÂçï
    ball.addEventListener('contextmenu', (e) => {
        e.preventDefault();
        return false;
    });

    // Á¶ÅÁî®Ëß¶Êë∏ÈÄâÊã©
    document.addEventListener('touchmove', (e) => {
        if (e.target === ball || ball.contains(e.target)) {
            e.preventDefault();
            return false;
        }
    }, { passive: false });

    // Á¶ÅÁî®mouseupÂØºËá¥ÁöÑÈÄâÊã©
    document.addEventListener('mouseup', (e) => {
        if (e.target === ball || ball.contains(e.target)) {
            // Ê∏ÖÁ©∫‰ªª‰ΩïÂèØËÉΩÁöÑÈÄâÊã©
            if (window.getSelection) {
                window.getSelection().removeAllRanges();
            }
        }
    });
</script>
</body>
</html>